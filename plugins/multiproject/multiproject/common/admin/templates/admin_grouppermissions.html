<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
  <xi:include href="admin.html" />
  <head>
    <title>Groups</title>
  </head>

  <body>
    <h2>Manage Groups</h2>
    <py:if test="'PERMISSION_GRANT' in perm">
        <form id="addperm" class="addnew" method="post" action="">
          <div class="shaded-box">
            <fieldset id="rightpanel">
              <legend>Add permission to (<em title="You can create a new group by adding permission to inexisting group">new</em>) group</legend>
              <div class="inputrow">
                <div class="headtextfield">Group:</div>
                <div class="inputfield">
                  <input id="gp_subject" type="text" name="group" />
                </div>
              </div>
              <div class="inputrow">
                <div class="headtextfield">Permission:</div>
                <div class="inputfield">
                  <select id="permission" name="permission">
                    <option py:for="permission in sorted(available_permissions)">$permission</option>
                  </select>
                </div>
              </div>
              <div class="buttons">
                <span><input type="submit" name="add" value="${_('Add permission')}" /></span>
              </div>
            </fieldset>
          </div>
        </form>
    </py:if>

    <form id="revokeform" method="post" py:with="revoke_perm = 'PERMISSION_REVOKE' in perm" action="">
      <table class="listing" id="permlist">
        <thead>
          <tr><th>Group</th><th>Has permissions</th></tr>
        </thead>
        <tbody>
          <tr py:for="idx, (group, permissionlist) in enumerate(groupby(sorted(group_permissions), key=lambda tmp: tmp[0]))"
              class="${idx % 2 and 'odd' or 'even'}">
            <td>
              <div>
                <input py:if="revoke_perm" type="checkbox" id="$group" name="groupremovelist" value="$group" />
                <label for="$group">$group</label>
              </div>
              <py:choose>
                <div class="nousers" py:when="not group_users[0][group] and not group_users[1][group]">THIS GROUP IS EMPTY</div>
                <div class="usercount" py:when="group_users[0][group] and group_users[1][group]">
                    <span py:if="group_users[0][group] == 1">${group_users[0][group]} USER</span>
                    <span py:if="group_users[0][group] > 1">${group_users[0][group]} USERS</span>
                    <span py:if="group_users[1][group] == 1">${group_users[1][group]} USER TYPE</span>
                    <span py:if="group_users[1][group] > 1">${group_users[1][group]} USER TYPES</span>
                </div>
                <div class="usercount" py:when="group_users[0][group]">
                    <span py:if="group_users[0][group] == 1">${group_users[0][group]} USER</span>
                    <span py:if="group_users[0][group] > 1">${group_users[0][group]} USERS</span>
                </div>
                <div class="usercount" py:otherwise="">
                    <span py:if="group_users[1][group] == 1">${group_users[1][group]} USER TYPE</span>
                    <span py:if="group_users[1][group] > 1">${group_users[1][group]} USER TYPES</span>
                </div>
              </py:choose>
            </td>
            <td>
              <py:for each="(group, permission) in permissionlist">
                <div py:if="permission">
                  <input py:if="revoke_perm" type="checkbox" id="$group::$permission" name="permremovelist" value="$group::$permission" />
                  <label for="$group::$permission">$permission</label>
                </div>
              </py:for>
            </td>
          </tr>
        </tbody>
      </table>
      <br/>
      <div class="buttons" py:if="revoke_perm">
        <span class="primaryButton">
          <input type="submit" name="remove" value="${_('Remove selected groups or permissions')}" />
         </span>
      </div>

      <div id="guide" class="shaded-box" style="margin-top:30px;">
        <h4>Guide</h4>
        <br />
        <p class="help">
          Select and remove rights or entire groups.
          Add permissions to existing groups or create new groups using the form on the top right.
        </p>
        <p class="help">
          Create a new group based on an existing template using the second form on the right.
        </p>
        <p class="help">
          If you want to reset your permissions keep the groups "Project owners" and "Project members"
          and remove all others. If you want to make the project private you are done, otherwise click
          on the "Basic Settings" menu on the top left of the admin area and click on "Make public",
          this will recreate the groups "Public contributors" and "Public viewers" with the correct
          permissions.
         </p>
      </div>
    </form>

  </body>

</html>
